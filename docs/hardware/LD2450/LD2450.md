# LD2450

The **HLK-LD2450** is a 24GHz millimeter-wave (mmWave) radar sensor used for car positioning in this project.

## Sensor Capabilities

- Detects up to 3 targets simultaneously with X/Y coordinate tracking
- Centimeter-level accuracy (±1mm)
- UART communication at 256000 baud
- Range up to 6+ meters
- Operates reliably in garage conditions (temperature swings, dust, humidity, exhaust fumes)

## Why mmWave Over Ultrasonic

| Factor | Ultrasonic (HC-SR04) | mmWave (LD2450) |
| ---- | ---- | ---- |
| Accuracy | ±3mm | ±1mm |
| Range | 2cm - 4m | Up to 6m+ |
| Temperature Sensitivity | High (sound speed varies) | Minimal |
| Humidity/Dust | Affected | Unaffected |
| Multi-target Tracking | No | Yes (up to 3) |

## Dual Sensor Configuration

This project uses **two LD2450 sensors** to triangulate the car's center position:

- **Front Sensor** — Reports X, Y, and distance to the front of the car
- **Rear Sensor** — Reports X, Y, and distance to the rear of the car

The firmware averages readings from both sensors to calculate the car's center position, determining whether the car is detected and correctly parked.

## Sensor Placement

### Front Sensor

- Mount on the **front wall** of the garage, closest to the garage door opening
- Wall-mounted, facing toward where the car will be parked
- Accuracy: ±1-2 cm distance, ±3-5 cm position

### Rear Sensor

- Mount on the **ceiling**, positioned to see the back of the car (trunk/bumper area)
- Further from the garage door than the Front Sensor
- Height of 2-3 meters is ideal
- Point straight down or angled slightly toward the incoming car
- Accuracy: ±2-3 cm distance, ±5-10 cm position

### Placement Diagram

```text
      +-----------------------------------------------------------+
      |                    GARAGE (Top-Down View)                 |
      |                                                           |
      |           (Rear Sensor - CEILING MOUNTED)                 |
      |                                                           |
      |    +---------------------------------------------------+  |
      |    |                    Car Here                       |  |
      |    +---------------------------------------------------+  |
      |                                                           |
      |           (Front Sensor - WALL MOUNTED)                   |
      |                                                           |
      +===========================================================+
                         (Garage Door Opening)
```

### Key Placement Considerations

- **Clear line of sight** — Both sensors need an unobstructed view of the car
- **Rear Sensor position** — Mount ~1-1.5 meters back from where you want the front bumper to stop
- **Separation matters** — The dual-sensor approach requires them to see different parts of the car (front vs rear) to calculate the center accurately
- **Target zone calibration** — Adjust `target_y_min`/`target_y_max` and `target_x_tolerance` in your ESPHome config based on actual sensor positions

## Person Detection

The LD2450 can detect people in addition to vehicles:

- **Stationary presence** — Detects someone standing still or sitting in a car
- **Multi-target tracking** — Tracks up to 3 targets simultaneously (car + people)
- **X/Y coordinates** — Each target reports position, enabling zone-based detection

### Multi-Target Tracking

The LD2450 reports up to 3 targets, ordered by signal strength (typically size):

| Target | Typical Object | Use Case |
| ---- | ---- | ---- |
| Target 1 | Car (largest) | Primary vehicle positioning |
| Target 2 | Person | Danger zone detection |
| Target 3 | Second person or pet | Additional safety monitoring |

Each target provides:

- **X position** — Horizontal offset from sensor centerline (mm)
- **Y position** — Distance along sensor axis (mm)
- **Distance** — Direct line distance to target (mm)
- **Speed** — Movement velocity (cm/s)

### Danger Zone Detection

The firmware monitors Target 2 from both Front and Rear Sensors to detect people in the path of the vehicle:

```text
      +-----------------------------------------------------------+
      |                    GARAGE (Top-Down View)                 |
      |                                                           |
      |           (Rear Sensor) ← monitors BEHIND car             |
      |                  ↓                                        |
      |          [DANGER ZONE - REAR]                             |
      |    +---------------------------------------------------+  |
      |    |                    Car Here                       |  |
      |    +---------------------------------------------------+  |
      |          [DANGER ZONE - FRONT]                            |
      |                  ↑                                        |
      |           (Front Sensor) ← monitors IN FRONT of car       |
      |                                                           |
      +===========================================================+
```

**Safety behavior:**

- When car is detected (Target 1 valid) AND person detected (Target 2 valid within danger distance)
- LED strip flashes red with "Person Alert" effect
- Parking guidance shows `!!! STOP - PERSON !!!`

**Use cases:**

- Warn driver if someone is behind the car while backing in
- Alert if someone is in front of the car while pulling forward
- Alert if a child or pet enters the parking area
- Safety interlock before closing garage door

### ESPHome Configuration

The danger zone is configured via substitutions:

```yaml
substitutions:
  # Max distance (mm) from sensor where person triggers alert
  danger_zone_distance: "3000"
```

Target 2 sensors are defined for each LD2450:

```yaml
- platform: ld2450
  ld2450_id: ld2450_front
  target_2:
    distance:
      id: front_t2_distance
    x:
      id: front_t2_x
    y:
      id: front_t2_y
```

See `esphome/simple-wifi.yaml` for the complete implementation.

## Hardware Details

I used the JMT HLK-LD2450 24GHz Trajectory Sensor ISM

![HLK-LD2450](../../docs/images/HLK-LD2450.png)
Which has the The 1.5mmx4Pin Female connector

1.5mmx4Pin Female (Customizable)

## Black Pin Header

| LEFT | RIGHT |
| ----- | ---- |
| 5V | RX |
| NC | TX |
| NC | NC |
| GND | NC |

### Header Pins

The 1.5mm is not common.

[JST ZH 1.5mm 4Pin Connector with 200mm](https://www.amazon.com/dp/B0DQZP5QD9)

| Wire | Pin | Function |
| ---- | ---- | ----- |
| BLACK | 5V | Power supply input 5V |
| RED | Rx | Serial port Rx pin |
| WHITE | Tx | Serial port Tx pin |
| YELLOW | GND | Power ground |

## Documentation

[HLK-LD2450](LD2450%20serial%20port%20communication%20protocol%20V1.03.pdf)
